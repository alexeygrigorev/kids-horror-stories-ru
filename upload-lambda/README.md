# S3 File Upload with Presigned URL and Progress Indicator

## Overview

This project provides a solution for securely uploading files to an S3 bucket using a presigned URL generated by an AWS Lambda function. The solution includes a mobile-friendly HTML interface with progress indicators for each file being uploaded.

## Prerequisites

- AWS Account
- AWS CLI configured with appropriate permissions
- Basic understanding of AWS services (S3, Lambda, API Gateway)

## Deployment Steps

### 1. Create S3 Bucket

1. Go to the AWS S3 console.
2. Create a new bucket (e.g., `kids-horror-stories-ru-images`).

### 2. Configure S3 Bucket CORS

1. Open the S3 console.
2. Select your bucket.
3. Go to the "Permissions" tab.
4. Click "Edit" under the "Cross-origin resource sharing (CORS)" section.
5. Add the following CORS configuration and save:

```json
[
    {
    "AllowedHeaders": [
        "*"
    ],
    "AllowedMethods": [
        "GET",
        "POST",
        "PUT",
        "HEAD"
    ],
    "AllowedOrigins": [
        "*"
    ],
    "ExposeHeaders": [
        "ETag"
    ],
    "MaxAgeSeconds": 3000
    }
]
```

### 3. Package Lambda Function

1. Ensure `lambda_function.py` and `index.html` are in the same directory.
2. Zip the files:

    ```bash
    zip -r function.zip lambda_function.py index.html
    ```

### 4. Deploy Lambda Function

1. Open the AWS Lambda console.
2. Create a new Lambda function.
3. Choose "Upload a .zip file" and upload `function.zip`.
4. Configure the function to use an IAM role with S3 permissions.
5. Set the handler to `lambda_function.lambda_handler`.

### 5. Set Up API Gateway

1. Open the AWS API Gateway console.
2. Create a new REST API.
3. Create a new resource (e.g., `/upload`).
4. Create two methods under the resource: `GET` and `POST`.

#### Configure GET Method

1. Select the `GET` method.
2. Choose "Lambda Function" as the integration type.
3. Select the Lambda function you created.
4. Deploy the API to a stage (e.g., `prod`). Default stage is also OK.

#### Configure POST Method

1. Select the `POST` method.
2. Choose "Lambda Function" as the integration type.
3. Select the Lambda function you created.
4. Deploy the API to the same stage.

For both GET and POST the url should be `/`.

### 6. Test the Deployment

1. Open the URL for the deployed API stage (e.g., `https://<api-id>.execute-api.<region>.amazonaws.com/prod/upload`).
2. You should see the HTML form for uploading files.
3. Enter the password and select files to upload.
4. Monitor the progress bars as files are uploaded to the `input/` directory in your S3 bucket.

## Repository Structure

- `lambda_function.py`: The Lambda function code.
- `index.html`: The HTML file served by the Lambda function.

## Notes

- Ensure that the password in the `lambda_function.py` matches what you enter in the form.
- The CORS configuration allows all origins and methods for simplicity. Adjust this based on your security requirements.

## Troubleshooting

- If you encounter CORS errors, ensure the CORS configuration in the S3 bucket is correct.
- Check the Lambda function logs in CloudWatch for any errors during execution.
- Ensure the IAM role used by the Lambda function has the necessary permissions to generate presigned URLs and put objects in the S3 bucket.
